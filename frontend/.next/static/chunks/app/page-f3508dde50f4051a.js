(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4541:(e,t,r)=>{"use strict";r.d(t,{J:()=>l,default:()=>c});var a=r(5155),o=r(6203),s=r(2115),n=r(6104);let i=(0,s.createContext)({user:null,loading:!0}),l=()=>(0,s.useContext)(i);function c(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=(0,o.hg)(n.j,e=>{l(e),d(!1)},e=>{console.error("Firebase AuthStateChanged error:",e),l(null),d(!1)});return()=>e()},[]),(0,a.jsx)(i.Provider,{value:{user:r,loading:c},children:t})}},6104:(e,t,r)=>{"use strict";r.d(t,{db:()=>c,j:()=>i,q:()=>l});var a=r(3915),o=r(6203),s=r(5317);let n=(0,a.Dk)().length?(0,a.Dk)()[0]:(0,a.Wp)({apiKey:"AIzaSyBY6tYhLSBAoWlNpTG-VzFm-qFgdiG9elE",authDomain:"forkly-da5a7.firebaseapp.com",projectId:"forkly-da5a7",storageBucket:"forkly-da5a7.firebasestorage.app",messagingSenderId:"738393752123",appId:"1:738393752123:web:9985da4d74ba5d7f1f921e"}),i=(0,o.xI)(n);window.Cypress&&(window.firebase_auth_instance=i,console.log("Firebase auth instance exposed to window for Cypress."));let l=new o.HF,c=(0,s.aU)(n)},6245:(e,t,r)=>{Promise.resolve().then(r.bind(r,9924))},9924:(e,t,r)=>{"use strict";r.d(t,{default:()=>w});var a=r(5155),o=r(2115),s=r(5695);class n extends Error{constructor(e,t){super(e),this.name="GeolocationServiceError",this.code=t,Object.setPrototypeOf(this,n.prototype)}}function i(e){let{onSearch:t,onLocate:r,initialQuery:s="",initialLocation:i=""}=e,[l,c]=(0,o.useState)(s),[d,u]=(0,o.useState)(i),{coords:g,request:h}=function(){let[e,t]=(0,o.useState)(null),[r,a]=(0,o.useState)(null);return{coords:e,error:r,request:async function(){if(a(null),t(null),!navigator.geolocation)return void a("Geolocation not supported by your browser.");try{let e=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(t=>{e(t)},e=>{t(new n(e.message,e.code))},{enableHighAccuracy:!1,timeout:8e3,maximumAge:0})});t(e.coords)}catch(e){if(e instanceof n){let t="Geolocation error: ";switch(e.code){case GeolocationPositionError.PERMISSION_DENIED:t+="Permission denied to access location.";break;case GeolocationPositionError.POSITION_UNAVAILABLE:t+="Location information is unavailable.";break;case GeolocationPositionError.TIMEOUT:t+="The request to get user location timed out.";break;default:t+=e.message}a(t)}else e instanceof Error?a("An unexpected error occurred: ".concat(e.message)):a("An unknown geolocation error occurred.");console.error("Geolocation request failed:",e)}}}}();return(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,a.jsx)("input",{value:l,onChange:e=>c(e.target.value),placeholder:"What?",className:"h-10 flex-1 border p-2 rounded bg-white text-gray-900 dark:bg-gray-800 dark:text-gray-100"}),(0,a.jsx)("input",{value:d,onChange:e=>u(e.target.value),placeholder:"Where?",className:"h-10 flex-1 border p-2 rounded bg-white text-gray-900 dark:bg-gray-800 dark:text-gray-100"}),(0,a.jsx)("button",{onClick:()=>{d.trim()&&t(l,d)},className:"h-10 px-4 bg-indigo-600 text-white rounded",disabled:!l||!d,children:"Search"}),(0,a.jsx)("button",{onClick:()=>{(async()=>{g||await h(),g&&r(g.latitude,g.longitude,l)})()},className:"h-10 px-3 bg-emerald-600 text-white rounded",children:"Near me"})]})}var l=r(6766),c=r(8564),d=r(6562),u=r(8260),g=r(5317),h=r(6104);async function f(e,t){let r=(0,g.H9)(h.db,"wishlists",e,"items",t);await (0,g.BN)(r,{addedAt:Date.now()})}var p=r(4541);function m(e){let{bizId:t}=e,{user:r,loading:s}=(0,p.J)(),[n,i]=(0,o.useState)(!1);if(s||!r)return null;let l=async()=>{i(!0);try{await f(r.uid,t),u.oR.success("Added to wishlist!")}catch(e){u.oR.error("Could not save, try again."),console.error("Error adding to wishlist:",e)}finally{i(!1)}};return(0,a.jsx)("button",{onClick:()=>{l()},className:"ml-2 text-xs text-indigo-600 hover:underline disabled:opacity-50 disabled:cursor-not-allowed",disabled:n,children:n?"Saving...":"Save"})}function x(e){let{rating:t}=e,r=Math.floor(t),o=+(t%1>=.5);return(0,a.jsxs)("span",{className:"inline-flex",children:[Array.from({length:r}).map((e,t)=>(0,a.jsx)(c.A,{size:16},"f".concat(t))),1===o&&(0,a.jsx)(d.A,{size:16}),Array.from({length:5-r-o}).map((e,t)=>(0,a.jsx)(c.A,{size:16,className:"opacity-40"},"o".concat(t)))]})}function y(e){let{id:t,name:r,rating:o,price:s,category:n,photoUrl:i}=e;return(0,a.jsxs)("article",{className:"flex flex-col h-full rounded-xl border shadow transition","data-testid":"restaurant-card",children:[(0,a.jsx)("div",{className:"relative h-32 sm:h-40 w-full",children:(0,a.jsx)(l.default,{src:null!=i?i:"/placeholder.png",alt:r,fill:!0,className:"rounded-t-xl object-cover",sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"})}),(0,a.jsxs)("div",{className:"flex-1 p-3 flex flex-col justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("h3",{className:"font-semibold flex-1 text-gray-900 dark:text-gray-100",children:r}),(0,a.jsx)(m,{bizId:t})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:[(0,a.jsx)(x,{rating:o})," ",o.toFixed(1)," •",(0,a.jsx)("span",{className:function(e){if(!e)return"text-gray-500";switch(e.replace(/[¥￥€]/g,"$")){case"$":return"text-emerald-600";case"$$":return"text-amber-600";case"$$$":return"text-rose-600";default:return"text-gray-500"}}(s)+" dark:opacity-90",children:null!=s?s:"?"}),"\xa0• ",n]})]})]})}async function b(e){let t=new URL("/api/search",window.location.origin);Object.entries(e).forEach(e=>{let[r,a]=e;void 0!==a&&""!==a&&t.searchParams.set(r,String(a))}),console.log("searchFoursquare: Calling API with URL:",t.toString());let r=await fetch(t.toString());if(!r.ok){let e="API error: ".concat(r.status," ").concat(r.statusText);try{let t=await r.json();(null==t?void 0:t.error)?e+=" - Details: ".concat(t.error):(null==t?void 0:t.message)?e+=" - Details: ".concat(t.message):Object.keys(t).length>0&&(e+=" - Body: ".concat(JSON.stringify(t)))}catch(t){console.warn("searchFoursquare: Could not parse error response body as JSON.",t),e+=" - Could not parse error response body. Original error: ".concat(t instanceof Error?t.message:String(t))}throw console.error("searchFoursquare: Fetch failed with error:",e),Error(e)}try{let e=await r.json();if(console.log("searchFoursquare: Received data:",e),!e.businesses||!Array.isArray(e.businesses))throw Error("API response is missing 'businesses' array or it's not an array.");return e.businesses}catch(e){throw console.error("searchFoursquare: Error parsing JSON response:",e),Error("Invalid JSON response from API. Details: "+(e instanceof Error?e.message:String(e)))}}function w(){var e;let t,r=(0,s.useSearchParams)(),n=(0,s.useRouter)(),[l,c]=(0,o.useState)([]),[d,u]=(0,o.useState)(!1),[g,h]=(0,o.useState)("restaurants"),[f,p]=(0,o.useState)(()=>{var e;return null!=(e=r.get("term"))?e:""}),[m,x]=(0,o.useState)(()=>{var e;return null!=(e=r.get("location"))?e:""}),[w,S]=(0,o.useState)([]),[v,j]=(0,o.useState)([]),[N,E]=(0,o.useState)(null),[k,A]=(0,o.useState)(!1);(0,o.useEffect)(()=>{A(!0)},[]);let C=(0,o.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};E(null),u(!0);try{console.log("fetchResultsCore: Preparing to search with query:",e,"and opts:",t);let r=await b({term:e,...t,price:w.join(",")||void 0,categories:v.join(",")||void 0});c(r),console.log("fetchResultsCore: Received successful data:",r)}catch(e){console.error("fetchResultsCore: Error during search operation:",e),c([]),E("Search failed: ".concat(e instanceof Error?e.message:String(e)))}finally{u(!1)}},[w,v]),P=(0,o.useRef)((e=(e,t)=>{C(e,t)},t=null,function(){for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];t&&clearTimeout(t),t=setTimeout(()=>{e.apply(this,a),t=null},500)})).current;(0,o.useEffect)(()=>{var e,t;let a=null!=(e=r.get("term"))?e:"",o=null!=(t=r.get("location"))?t:"",s=r.getAll("price")||[],n=r.getAll("categories")||[];if(p(a),x(o),S(s),j(n),h(a||"restaurants"),console.log("useEffect: currentTerm:",a,"currentLocation:",o),!a&&!o&&!r.get("latitude")&&!r.get("longitude")){console.log("useEffect: No search parameters found in URL, not initiating search."),c([]),E(null);return}let i=o||r.get("latitude")&&r.get("longitude");if(a&&i){console.log("useEffect: Initiating debounced search with term:",a,"location data present.");let e={};o&&(e.location=o),r.get("latitude")&&r.get("longitude")&&(e.latitude=Number(r.get("latitude")),e.longitude=Number(r.get("longitude"))),P(a,e)}else a&&!i&&console.log("useEffect: Term present but no location data. Not initiating full search.")},[r,P]);let I=e=>{let t=w.includes(e)?w.filter(t=>t!==e):[...w,e];S(t);let a=new URLSearchParams(r.toString());r.getAll("price").forEach(e=>a.delete("price",e)),t.forEach(e=>a.append("price",e)),f&&a.set("term",f),m&&a.set("location",m),r.get("latitude")&&a.set("latitude",r.get("latitude")),r.get("longitude")&&a.set("longitude",r.get("longitude")),n.replace("/?".concat(a.toString()))},R=e=>{let t=v.includes(e)?v.filter(t=>t!==e):[...v,e];j(t);let a=new URLSearchParams(r.toString());r.getAll("categories").forEach(e=>a.delete("categories",e)),t.forEach(e=>a.append("categories",e)),f&&a.set("term",f),m&&a.set("location",m),r.get("latitude")&&a.set("latitude",r.get("latitude")),r.get("longitude")&&a.set("longitude",r.get("longitude")),n.replace("/?".concat(a.toString()))};return(0,a.jsxs)("main",{className:"container flex flex-col pt-4 pb-12",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-center mb-6",children:"Find your next favorite spot"}),(0,a.jsx)(i,{onSearch:(e,t)=>{p(e),x(t);let r=new URLSearchParams;e&&r.set("term",e),t&&r.set("location",t),w.forEach(e=>r.append("price",e)),v.forEach(e=>r.append("categories",e)),n.replace("/?".concat(r.toString()))},onLocate:(e,t,r)=>{p(r),x("");let a=new URLSearchParams;r&&a.set("term",r),a.set("latitude",e.toString()),a.set("longitude",t.toString()),w.forEach(e=>a.append("price",e)),v.forEach(e=>a.append("categories",e)),n.replace("/?".concat(a.toString()))},initialQuery:f,initialLocation:m}),(0,a.jsxs)("div",{className:"my-6 flex gap-2 justify-center flex-wrap",children:[["1","2","3","4"].map(e=>(0,a.jsx)("button",{onClick:()=>I(e),className:"px-3 py-1 rounded border\n                        ".concat(w.includes(e)?"bg-gray-900 text-white dark:bg-gray-100 dark:text-gray-900":"bg-gray-200 dark:bg-gray-700"),children:"$".repeat(Number(e))},e)),[{id:"13000",name:"Pizza"},{id:"13065",name:"Thai"},{id:"13035",name:"Coffee Shop"},{id:"13028",name:"Mexican"},{id:"13064",name:"Sushi"},{id:"13049",name:"Burger"}].map(e=>(0,a.jsxs)("button",{onClick:()=>R(e.id),className:"px-3 py-1 rounded border capitalize\n                        ".concat(v.includes(e.id)?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-gray-700"),children:[e.name," "]},e.id))]}),d&&(0,a.jsx)("p",{className:"text-center py-10 text-gray-500",children:"Loading…"}),N&&(0,a.jsx)("p",{className:"text-center py-10 text-red-500",children:N}),k&&!d&&!N&&(0,a.jsx)(a.Fragment,{children:l.length>0?(0,a.jsx)("section",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:l.map(e=>{var t;return(0,a.jsx)(y,{id:e.id,name:e.name,rating:e.rating,price:e.price,category:null!=(t=e.category)?t:"N/A",photoUrl:e.photoUrl},e.id)})}):(0,a.jsxs)("p",{className:"text-center py-10 text-gray-500",children:["No results for “",g,"”."]})}),!k&&(0,a.jsx)("p",{className:"text-center py-10 text-gray-500",children:"Loading content..."})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,811,412,22,758,441,684,358],()=>t(6245)),_N_E=e.O()}]);